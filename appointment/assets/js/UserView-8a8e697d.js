import{_ as B,A as M}from"./AllCountryView-fe9e9d31.js";import{u as D,_ as T}from"./common-096e9932.js";import{d as W,r as y,c as G,s as H,b as J,e as p,i as r,f as e,w as o,F as E,u as K,t as L,g,h as _,j as u,v as b,x,k as Q,l as N,E as k,a as X,y as Y,z as Z,_ as ee}from"./index-2aa5bd53.js";import{e as ae,f as oe}from"./common-c6b9cbbf.js";const te={class:"index-view"},se={class:"col-content-right"},le={class:"top-content"},ne={class:"con"},re={key:0,style:{"font-size":"0.5rem"}},ue={class:"con"},de={key:0,style:{"font-size":"0.5rem"}},ie={key:0},ce={key:0},me={key:1},pe={class:"footer-btns"},_e=W({name:"User",__name:"UserView",setup(fe){const t=D(),$=y(null),C=K(),w=y(),V=y(),m=y(0),z=y(),s=y({name:"",phone:"",code:""}),R=G(()=>({name:[{required:!0,message:"请输入姓名",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",validator:(d,a,c)=>{a?/^1[3-9]\d{9}$/.test(a)?c():c(new Error("请输入正确的手机号")):c(new Error("请输入手机号"))},trigger:"blur"}],code:[{required:!0,min:4,max:6,message:"请输入4-6位验证码",trigger:"blur"}]})),S=()=>{if(m.value>0)return!1;if(!w.value)return k.error("请先选择手机区号！！");if(!s.value.phone)return k.error("请先输入手机号码！！");if(!/^1[3-9]\d{9}$/.test(s.value.phone))return k.error("请先输入正确的手机号码！！");V.value&&V.value.show()},I=H(()=>{$.value.validate(async d=>{if(d){const a=L.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});console.log("请求参数：",t.pageOneParams.params);const c={mobile:`${w.value.replace("+","")}-${s.value.phone}`,username:s.value.name,verificationCode:s.value.code},f=Object.assign(X(t.pageOneParams.params),c),i=await oe({...f});i&&i.code===2e4?(a.close(),t.setPageOneParamsFn({...t.pageOneParams,word:{...t.pageOneParams.word,name:s.value.name,phone:`${w.value.replace("+","")}-${s.value.phone}`,newCustomered:i.data.newCustomered,newCustomeredId:i.data.id},userInfo:{...i.data}}),C.push("/poinSuccess")):(a.close(),k.error(i.message))}else console.log("error submit!!")})},500),A=d=>{w.value=d},F=async d=>{if(console.log("aaaaa",w.value),m.value)return!1;const a=L.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});try{await ae({mobile:`${w.value.replace("+","")}-${s.value.phone}`,captcha:d}),a.close(),m.value=60,z.value=setInterval(()=>{m.value?m.value=m.value-1:clearInterval(z.value)},1e3)}catch{a.close()}},j=()=>{C.back()};return J(()=>{var d,a;console.log(t.pageOneParams),(!t.pageOneParams||!((d=t.pageOneParams)!=null&&d.params)||!((a=t.pageOneParams)!=null&&a.word))&&C.push("/index")}),(d,a)=>{const c=g("el-icon"),f=g("el-col"),i=g("el-row"),v=g("el-form-item"),U=g("el-form"),P=g("el-input"),O=g("el-button"),q=B;return _(),p(E,null,[r("div",te,[e(i,null,{default:o(()=>[e(f,{span:24},{default:o(()=>[r("div",se,[a[6]||(a[6]=r("div",{class:"top-logo"},[r("img",{src:T,alt:""})],-1)),r("div",le,[e(i,null,{default:o(()=>[e(f,{span:12},{default:o(()=>{var l,n;return[r("div",ne,[e(c,{style:{"font-size":"0.55rem"}},{default:o(()=>[e(u(Y))]),_:1}),(l=u(t).pageOneParams)!=null&&l.word?(_(),p("span",re,b((n=u(t).pageOneParams)==null?void 0:n.word.date),1)):x("",!0)])]}),_:1}),e(f,{span:12},{default:o(()=>{var l,n;return[r("div",ue,[e(c,{style:{"font-size":"0.5rem"}},{default:o(()=>[e(u(Z))]),_:1}),(l=u(t).pageOneParams)!=null&&l.word?(_(),p("span",de,b((n=u(t).pageOneParams)==null?void 0:n.word.time),1)):x("",!0)])]}),_:1})]),_:1})]),e(U,{ref:"formRef1","label-position":"left",model:s.value,rules:u(R)},{default:o(()=>{var l;return[e(v,{label:"门店:"},{default:o(()=>{var n,h;return[(n=u(t).pageOneParams)!=null&&n.word?(_(),p("div",ie,b((h=u(t).pageOneParams)==null?void 0:h.word.stormName),1)):x("",!0)]}),_:1}),(_(!0),p(E,null,Q((l=u(t).pageOneParams)==null?void 0:l.word.list,(n,h)=>(_(),p("div",{key:h},[e(v,{label:"类别:"},{default:o(()=>[r("div",null,b(n.categoryList),1)]),_:2},1024),e(v,{label:"服务:"},{default:o(()=>[r("div",null,b(n.productList),1)]),_:2},1024),e(v,{label:"员工:"},{default:o(()=>[r("div",null,b(n.customerName),1)]),_:2},1024)]))),128))]}),_:1},8,["model","rules"]),e(U,{ref_key:"formRef",ref:$,"label-position":"top",model:s.value,rules:u(R)},{default:o(()=>[e(v,{label:"姓名:",prop:"name"},{default:o(()=>[e(P,{modelValue:s.value.name,"onUpdate:modelValue":a[0]||(a[0]=l=>s.value.name=l),placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1}),e(v,{label:"手机号",prop:"phone"},{default:o(()=>[e(P,{modelValue:s.value.phone,"onUpdate:modelValue":a[1]||(a[1]=l=>s.value.phone=l),placeholder:"请输入手机号",class:"input-with-select",style:{width:"73%"},type:"number"},{prepend:o(()=>[e(M,{onChangeCountry:A})]),_:1},8,["modelValue"]),a[3]||(a[3]=r("span",{style:{display:"inline-block",width:"2%"}},null,-1)),e(O,{style:{width:"25%"},onClick:S},{default:o(()=>[m.value===0?(_(),p("span",ce,"发送验证码")):(_(),p("span",me,"("+b(m.value)+"s)",1))]),_:1})]),_:1,__:[3]}),e(v,{label:"验证码",prop:"code"},{default:o(()=>[e(P,{modelValue:s.value.code,"onUpdate:modelValue":a[2]||(a[2]=l=>s.value.code=l),placeholder:"请输入验证码",class:"input-with-select",style:{width:"100%"},type:"number"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),r("div",pe,[e(i,{gutter:24},{default:o(()=>[e(f,{span:12,class:"back-btn-col"},{default:o(()=>[e(O,{class:"back-btn",onClick:j},{default:o(()=>a[4]||(a[4]=[N("返回")])),_:1,__:[4]})]),_:1}),e(f,{span:12,class:"sure-btn-col"},{default:o(()=>[e(O,{class:"sure-btn",onClick:u(I)},{default:o(()=>a[5]||(a[5]=[N(" 确认 ")])),_:1,__:[5]},8,["onClick"])]),_:1})]),_:1})])])]),_:1})]),_:1})]),e(q,{mode:"pop",explain:d.$t("explainWord"),captchaType:"blockPuzzle",imgSize:{width:"330px",height:"155px"},ref_key:"verifyRef",ref:V,onSuccess:F},null,8,["explain"])],64)}}});const he=ee(_e,[["__scopeId","data-v-472f5b70"]]);export{he as default};
