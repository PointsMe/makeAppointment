import{_ as B,A as M}from"./AllCountryView-57a2df6d.js";import{u as D,_ as T}from"./common-2384e8a9.js";import{d as W,r as w,c as G,v as H,b as J,e as m,i as r,f as e,w as o,F as $,u as K,x as L,g as v,h as _,j as c,y as g,s as O,k as Q,l as N,m as x,a as X,z as Y,A as Z,_ as ee}from"./index-9a35dd1a.js";import{f as ae,h as oe}from"./common-1cbda76d.js";const te={class:"index-view"},le={class:"col-content-right"},se={class:"top-content"},ne={class:"con"},re={key:0},ue={class:"con"},de={key:0},ce={key:0},ie={key:0},pe={key:1},me={class:"footer-btns"},_e=W({name:"User",__name:"UserView",setup(fe){const l=D(),R=w(null),k=K(),b=w(),C=w(),i=w(0),U=w(),s=w({name:"",phone:"",code:""}),S=G(()=>({name:[{required:!0,message:"请输入姓名",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",validator:(u,a,n)=>{a?n():n(new Error("请输入手机号"))},trigger:"blur"}],code:[{required:!0,min:4,max:6,message:"请输入4-6位验证码",trigger:"blur"}]})),A=()=>{if(i.value>0)return!1;if(!b.value)return x.error("请先选择手机区号！！");if(!s.value.phone)return x.error("请先输入手机号码！！");C.value&&C.value.show()},I=H(()=>{R.value.validate(async u=>{if(u){const a=L.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});console.log("请求参数：",l.pageOneParams.params);const n={mobile:`${b.value.replace("+","")}-${s.value.phone}`,username:s.value.name,verificationCode:s.value.code},h=Object.assign(X(l.pageOneParams.params),n);try{const d=await oe({...h});d&&d.code===2e4?(a.close(),l.setPageOneParamsFn({...l.pageOneParams,word:{...l.pageOneParams.word,name:s.value.name,phone:`${b.value.replace("+","")}-${s.value.phone}`,newCustomered:d.data.newCustomered,newCustomeredId:d.data.id},userInfo:{...d.data}}),k.push("/poinSuccess")):(a.close(),x.error(d.message))}catch{a.close()}}else console.log("error submit!!")})},500),z=u=>{b.value=u},E=async u=>{if(console.log("aaaaa",b.value),i.value)return!1;const a=L.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});try{await ae({mobile:`${b.value.replace("+","")}-${s.value.phone}`,captcha:u}),a.close(),i.value=60,U.value=setInterval(()=>{i.value?i.value=i.value-1:clearInterval(U.value)},1e3)}catch{a.close()}},F=()=>{k.back()};return J(()=>{var u,a;console.log(l.pageOneParams),(!l.pageOneParams||!((u=l.pageOneParams)!=null&&u.params)||!((a=l.pageOneParams)!=null&&a.word))&&k.push("/")}),(u,a)=>{const n=v("el-col"),h=v("el-icon"),d=v("el-row"),f=v("el-form-item"),V=v("el-input"),P=v("el-button"),j=v("el-form"),q=B;return _(),m($,null,[r("div",te,[e(d,null,{default:o(()=>[e(n,{span:9},{default:o(()=>a[3]||(a[3]=[r("div",{class:"col-content-left"},[r("img",{src:T,alt:""})],-1)])),_:1,__:[3]}),e(n,{span:6},{default:o(()=>[r("div",le,[r("div",se,[e(d,null,{default:o(()=>[e(n,{span:12},{default:o(()=>{var p,t;return[r("div",ne,[e(h,null,{default:o(()=>[e(c(Y))]),_:1}),(p=c(l).pageOneParams)!=null&&p.word?(_(),m("span",re,g((t=c(l).pageOneParams)==null?void 0:t.word.date),1)):O("",!0)])]}),_:1}),e(n,{span:12},{default:o(()=>{var p,t;return[r("div",ue,[e(h,null,{default:o(()=>[e(c(Z))]),_:1}),(p=c(l).pageOneParams)!=null&&p.word?(_(),m("span",de,g((t=c(l).pageOneParams)==null?void 0:t.word.time),1)):O("",!0)])]}),_:1})]),_:1})]),e(j,{ref_key:"formRef",ref:R,"label-position":"left",model:s.value,rules:c(S)},{default:o(()=>{var p;return[e(f,{label:"门店:"},{default:o(()=>{var t,y;return[(t=c(l).pageOneParams)!=null&&t.word?(_(),m("div",ce,g((y=c(l).pageOneParams)==null?void 0:y.word.stormName),1)):O("",!0)]}),_:1}),(_(!0),m($,null,Q((p=c(l).pageOneParams)==null?void 0:p.word.list,(t,y)=>(_(),m("div",{key:y},[e(f,{label:"类别:"},{default:o(()=>[r("div",null,g(t.categoryList),1)]),_:2},1024),e(f,{label:"服务:"},{default:o(()=>[r("div",null,g(t.productList),1)]),_:2},1024),e(f,{label:"员工:"},{default:o(()=>[r("div",null,g(t.customerName),1)]),_:2},1024)]))),128)),e(f,{label:"姓名:",prop:"name"},{default:o(()=>[e(V,{modelValue:s.value.name,"onUpdate:modelValue":a[0]||(a[0]=t=>s.value.name=t),placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1}),e(f,{label:"手机号",prop:"phone"},{default:o(()=>[e(V,{modelValue:s.value.phone,"onUpdate:modelValue":a[1]||(a[1]=t=>s.value.phone=t),placeholder:"请输入手机号",class:"input-with-select",style:{width:"77%"},type:"number"},{prepend:o(()=>[e(M,{onChangeCountry:z})]),_:1},8,["modelValue"]),a[4]||(a[4]=r("span",{style:{display:"inline-block",width:"3%"}},null,-1)),e(P,{style:{width:"20%"},onClick:A},{default:o(()=>[i.value===0?(_(),m("span",ie,"发送验证码")):(_(),m("span",pe,"("+g(i.value)+"s)",1))]),_:1})]),_:1,__:[4]}),e(f,{label:"验证码",prop:"code"},{default:o(()=>[e(V,{modelValue:s.value.code,"onUpdate:modelValue":a[2]||(a[2]=t=>s.value.code=t),placeholder:"请输入验证码",class:"input-with-select",type:"number",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]}),_:1},8,["model","rules"]),r("div",me,[e(d,{gutter:24},{default:o(()=>[e(n,{span:12,class:"back-btn-col"},{default:o(()=>[e(P,{class:"back-btn",onClick:F},{default:o(()=>a[5]||(a[5]=[N("返回")])),_:1,__:[5]})]),_:1}),e(n,{span:12,class:"sure-btn-col"},{default:o(()=>[e(P,{class:"sure-btn",onClick:c(I)},{default:o(()=>a[6]||(a[6]=[N(" 确认 ")])),_:1,__:[6]},8,["onClick"])]),_:1})]),_:1})])])]),_:1})]),_:1})]),e(q,{mode:"pop",explain:u.$t("explainWord"),captchaType:"blockPuzzle",imgSize:{width:"330px",height:"155px"},ref_key:"verifyRef",ref:C,onSuccess:E},null,8,["explain"])],64)}}});const ye=ee(_e,[["__scopeId","data-v-82f7a3f0"]]);export{ye as default};
