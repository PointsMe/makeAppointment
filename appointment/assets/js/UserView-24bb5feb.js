import{_ as B,A as M}from"./AllCountryView-fe9e9d31.js";import{u as D,_ as T}from"./common-096e9932.js";import{d as W,r as w,c as G,s as H,b as J,e as m,i as r,f as e,w as o,F as U,u as K,t as E,g as v,h as _,j as i,v as g,x,k as Q,l as L,E as k,a as X,y as Y,z as Z,_ as ee}from"./index-2aa5bd53.js";import{e as ae,f as oe}from"./common-c6b9cbbf.js";const te={class:"index-view"},se={class:"col-content-right"},le={class:"top-content"},ne={class:"con"},re={key:0},ue={class:"con"},de={key:0},ie={key:0},ce={key:0},pe={key:1},me={class:"footer-btns"},_e=W({name:"User",__name:"UserView",setup(fe){const s=D(),$=w(null),C=K(),b=w(),V=w(),c=w(0),R=w(),l=w({name:"",phone:"",code:""}),N=G(()=>({name:[{required:!0,message:"请输入姓名",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",validator:(u,a,n)=>{a?/^1[3-9]\d{9}$/.test(a)?n():n(new Error("请输入正确的手机号")):n(new Error("请输入手机号"))},trigger:"blur"}],code:[{required:!0,min:4,max:6,message:"请输入4-6位验证码",trigger:"blur"}]})),S=()=>{if(c.value>0)return!1;if(!b.value)return k.error("请先选择手机区号！！");if(!l.value.phone)return k.error("请先输入手机号码！！");if(!/^1[3-9]\d{9}$/.test(l.value.phone))return k.error("请先输入正确的手机号码！！");V.value&&V.value.show()},I=H(()=>{$.value.validate(async u=>{if(u){const a=E.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});console.log("请求参数：",s.pageOneParams.params);const n={mobile:`${b.value.replace("+","")}-${l.value.phone}`,username:l.value.name,verificationCode:l.value.code},h=Object.assign(X(s.pageOneParams.params),n);try{const d=await oe({...h});d&&d.code===2e4?(a.close(),s.setPageOneParamsFn({...s.pageOneParams,word:{...s.pageOneParams.word,name:l.value.name,phone:`${b.value.replace("+","")}-${l.value.phone}`,newCustomered:d.data.newCustomered,newCustomeredId:d.data.id},userInfo:{...d.data}}),C.push("/poinSuccess")):(a.close(),k.error(d.message))}catch{a.close()}}else console.log("error submit!!")})},500),z=u=>{b.value=u},A=async u=>{if(console.log("aaaaa",b.value),c.value)return!1;const a=E.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});try{await ae({mobile:`${b.value.replace("+","")}-${l.value.phone}`,captcha:u}),a.close(),c.value=60,R.value=setInterval(()=>{c.value?c.value=c.value-1:clearInterval(R.value)},1e3)}catch{a.close()}},F=()=>{C.back()};return J(()=>{var u,a;console.log(s.pageOneParams),(!s.pageOneParams||!((u=s.pageOneParams)!=null&&u.params)||!((a=s.pageOneParams)!=null&&a.word))&&C.push("/index")}),(u,a)=>{const n=v("el-col"),h=v("el-icon"),d=v("el-row"),f=v("el-form-item"),P=v("el-input"),O=v("el-button"),j=v("el-form"),q=B;return _(),m(U,null,[r("div",te,[e(d,null,{default:o(()=>[e(n,{span:9},{default:o(()=>a[3]||(a[3]=[r("div",{class:"col-content-left"},[r("img",{src:T,alt:""})],-1)])),_:1,__:[3]}),e(n,{span:6},{default:o(()=>[r("div",se,[r("div",le,[e(d,null,{default:o(()=>[e(n,{span:12},{default:o(()=>{var p,t;return[r("div",ne,[e(h,null,{default:o(()=>[e(i(Y))]),_:1}),(p=i(s).pageOneParams)!=null&&p.word?(_(),m("span",re,g((t=i(s).pageOneParams)==null?void 0:t.word.date),1)):x("",!0)])]}),_:1}),e(n,{span:12},{default:o(()=>{var p,t;return[r("div",ue,[e(h,null,{default:o(()=>[e(i(Z))]),_:1}),(p=i(s).pageOneParams)!=null&&p.word?(_(),m("span",de,g((t=i(s).pageOneParams)==null?void 0:t.word.time),1)):x("",!0)])]}),_:1})]),_:1})]),e(j,{ref_key:"formRef",ref:$,"label-position":"left",model:l.value,rules:i(N)},{default:o(()=>{var p;return[e(f,{label:"门店:"},{default:o(()=>{var t,y;return[(t=i(s).pageOneParams)!=null&&t.word?(_(),m("div",ie,g((y=i(s).pageOneParams)==null?void 0:y.word.stormName),1)):x("",!0)]}),_:1}),(_(!0),m(U,null,Q((p=i(s).pageOneParams)==null?void 0:p.word.list,(t,y)=>(_(),m("div",{key:y},[e(f,{label:"类别:"},{default:o(()=>[r("div",null,g(t.categoryList),1)]),_:2},1024),e(f,{label:"服务:"},{default:o(()=>[r("div",null,g(t.productList),1)]),_:2},1024),e(f,{label:"员工:"},{default:o(()=>[r("div",null,g(t.customerName),1)]),_:2},1024)]))),128)),e(f,{label:"姓名:",prop:"name"},{default:o(()=>[e(P,{modelValue:l.value.name,"onUpdate:modelValue":a[0]||(a[0]=t=>l.value.name=t),placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1}),e(f,{label:"手机号",prop:"phone"},{default:o(()=>[e(P,{modelValue:l.value.phone,"onUpdate:modelValue":a[1]||(a[1]=t=>l.value.phone=t),placeholder:"请输入手机号",class:"input-with-select",style:{width:"77%"},type:"number"},{prepend:o(()=>[e(M,{onChangeCountry:z})]),_:1},8,["modelValue"]),a[4]||(a[4]=r("span",{style:{display:"inline-block",width:"3%"}},null,-1)),e(O,{style:{width:"20%"},onClick:S},{default:o(()=>[c.value===0?(_(),m("span",ce,"发送验证码")):(_(),m("span",pe,"("+g(c.value)+"s)",1))]),_:1})]),_:1,__:[4]}),e(f,{label:"验证码",prop:"code"},{default:o(()=>[e(P,{modelValue:l.value.code,"onUpdate:modelValue":a[2]||(a[2]=t=>l.value.code=t),placeholder:"请输入验证码",class:"input-with-select",type:"number",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]}),_:1},8,["model","rules"]),r("div",me,[e(d,{gutter:24},{default:o(()=>[e(n,{span:12,class:"back-btn-col"},{default:o(()=>[e(O,{class:"back-btn",onClick:F},{default:o(()=>a[5]||(a[5]=[L("返回")])),_:1,__:[5]})]),_:1}),e(n,{span:12,class:"sure-btn-col"},{default:o(()=>[e(O,{class:"sure-btn",onClick:i(I)},{default:o(()=>a[6]||(a[6]=[L(" 确认 ")])),_:1,__:[6]},8,["onClick"])]),_:1})]),_:1})])])]),_:1})]),_:1})]),e(q,{mode:"pop",explain:u.$t("explainWord"),captchaType:"blockPuzzle",imgSize:{width:"330px",height:"155px"},ref_key:"verifyRef",ref:V,onSuccess:A},null,8,["explain"])],64)}}});const ye=ee(_e,[["__scopeId","data-v-5e60074a"]]);export{ye as default};
