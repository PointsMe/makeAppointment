import{_ as B,A as M}from"./AllCountryView-3937bbb9.js";import{u as D,_ as T}from"./common-7ba2b8f4.js";import{d as W,r as w,c as G,v as H,b as J,e as p,i as r,f as e,w as o,F as L,u as K,x as N,g,h as _,j as u,y as b,s as O,k as Q,l as S,m as x,a as X,z as Y,A as Z,_ as ee}from"./index-48aa1907.js";import{f as ae,h as oe}from"./common-d105a623.js";const te={class:"index-view"},se={class:"col-content-right"},le={class:"top-content"},ne={class:"con"},re={key:0,style:{"font-size":"0.5rem"}},ue={class:"con"},de={key:0,style:{"font-size":"0.5rem"}},ie={key:0},ce={key:0},me={key:1},pe={class:"footer-btns"},_e=W({name:"User",__name:"UserView",setup(fe){const t=D(),z=w(null),k=K(),y=w(),C=w(),c=w(0),R=w(),s=w({name:"",phone:"",code:""}),U=G(()=>({name:[{required:!0,message:"请输入姓名",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",validator:(d,a,m)=>{a?m():m(new Error("请输入手机号"))},trigger:"blur"}],code:[{required:!0,min:4,max:6,message:"请输入4-6位验证码",trigger:"blur"}]})),A=()=>{if(c.value>0)return!1;if(!y.value)return x.error("请先选择手机区号！！");if(!s.value.phone)return x.error("请先输入手机号码！！");C.value&&C.value.show()},I=H(()=>{z.value.validate(async d=>{if(d){const a=N.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});console.log("请求参数：",t.pageOneParams.params);const m={mobile:`${y.value.replace("+","")}-${s.value.phone}`,username:s.value.name,verificationCode:s.value.code},f=Object.assign(X(t.pageOneParams.params),m);try{const i=await oe({...f});i&&i.code===2e4?(a.close(),t.setPageOneParamsFn({...t.pageOneParams,word:{...t.pageOneParams.word,name:s.value.name,phone:`${y.value.replace("+","")}-${s.value.phone}`,newCustomered:i.data.newCustomered,newCustomeredId:i.data.id},userInfo:{...i.data}}),k.push("/poinSuccess")):(a.close(),x.error(i.message))}catch{a.close()}}else console.log("error submit!!")})},500),E=d=>{y.value=d},F=async d=>{if(console.log("aaaaa",y.value),c.value)return!1;const a=N.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});try{await ae({mobile:`${y.value.replace("+","")}-${s.value.phone}`,captcha:d}),a.close(),c.value=60,R.value=setInterval(()=>{c.value?c.value=c.value-1:clearInterval(R.value)},1e3)}catch{a.close()}},j=()=>{k.back()};return J(()=>{var d,a;console.log(t.pageOneParams),(!t.pageOneParams||!((d=t.pageOneParams)!=null&&d.params)||!((a=t.pageOneParams)!=null&&a.word))&&k.push("/")}),(d,a)=>{const m=g("el-icon"),f=g("el-col"),i=g("el-row"),v=g("el-form-item"),$=g("el-form"),V=g("el-input"),P=g("el-button"),q=B;return _(),p(L,null,[r("div",te,[e(i,null,{default:o(()=>[e(f,{span:24},{default:o(()=>[r("div",se,[a[6]||(a[6]=r("div",{class:"top-logo"},[r("img",{src:T,alt:""})],-1)),r("div",le,[e(i,null,{default:o(()=>[e(f,{span:12},{default:o(()=>{var l,n;return[r("div",ne,[e(m,{style:{"font-size":"0.55rem"}},{default:o(()=>[e(u(Y))]),_:1}),(l=u(t).pageOneParams)!=null&&l.word?(_(),p("span",re,b((n=u(t).pageOneParams)==null?void 0:n.word.date),1)):O("",!0)])]}),_:1}),e(f,{span:12},{default:o(()=>{var l,n;return[r("div",ue,[e(m,{style:{"font-size":"0.5rem"}},{default:o(()=>[e(u(Z))]),_:1}),(l=u(t).pageOneParams)!=null&&l.word?(_(),p("span",de,b((n=u(t).pageOneParams)==null?void 0:n.word.time),1)):O("",!0)])]}),_:1})]),_:1})]),e($,{ref:"formRef1","label-position":"left",model:s.value,rules:u(U)},{default:o(()=>{var l;return[e(v,{label:"门店:"},{default:o(()=>{var n,h;return[(n=u(t).pageOneParams)!=null&&n.word?(_(),p("div",ie,b((h=u(t).pageOneParams)==null?void 0:h.word.stormName),1)):O("",!0)]}),_:1}),(_(!0),p(L,null,Q((l=u(t).pageOneParams)==null?void 0:l.word.list,(n,h)=>(_(),p("div",{key:h},[e(v,{label:"类别:"},{default:o(()=>[r("div",null,b(n.categoryList),1)]),_:2},1024),e(v,{label:"服务:"},{default:o(()=>[r("div",null,b(n.productList),1)]),_:2},1024),e(v,{label:"员工:"},{default:o(()=>[r("div",null,b(n.customerName),1)]),_:2},1024)]))),128))]}),_:1},8,["model","rules"]),e($,{ref_key:"formRef",ref:z,"label-position":"top",model:s.value,rules:u(U)},{default:o(()=>[e(v,{label:"姓名:",prop:"name"},{default:o(()=>[e(V,{modelValue:s.value.name,"onUpdate:modelValue":a[0]||(a[0]=l=>s.value.name=l),placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1}),e(v,{label:"手机号",prop:"phone"},{default:o(()=>[e(V,{modelValue:s.value.phone,"onUpdate:modelValue":a[1]||(a[1]=l=>s.value.phone=l),placeholder:"请输入手机号",class:"input-with-select",style:{width:"73%"},type:"number"},{prepend:o(()=>[e(M,{onChangeCountry:E})]),_:1},8,["modelValue"]),a[3]||(a[3]=r("span",{style:{display:"inline-block",width:"2%"}},null,-1)),e(P,{style:{width:"25%"},onClick:A},{default:o(()=>[c.value===0?(_(),p("span",ce,"发送验证码")):(_(),p("span",me,"("+b(c.value)+"s)",1))]),_:1})]),_:1,__:[3]}),e(v,{label:"验证码",prop:"code"},{default:o(()=>[e(V,{modelValue:s.value.code,"onUpdate:modelValue":a[2]||(a[2]=l=>s.value.code=l),placeholder:"请输入验证码",class:"input-with-select",style:{width:"100%"},type:"number"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),r("div",pe,[e(i,{gutter:24},{default:o(()=>[e(f,{span:12,class:"back-btn-col"},{default:o(()=>[e(P,{class:"back-btn",onClick:j},{default:o(()=>a[4]||(a[4]=[S("返回")])),_:1,__:[4]})]),_:1}),e(f,{span:12,class:"sure-btn-col"},{default:o(()=>[e(P,{class:"sure-btn",onClick:u(I)},{default:o(()=>a[5]||(a[5]=[S(" 确认 ")])),_:1,__:[5]},8,["onClick"])]),_:1})]),_:1})])])]),_:1})]),_:1})]),e(q,{mode:"pop",explain:d.$t("explainWord"),captchaType:"blockPuzzle",imgSize:{width:"330px",height:"155px"},ref_key:"verifyRef",ref:C,onSuccess:F},null,8,["explain"])],64)}}});const he=ee(_e,[["__scopeId","data-v-559cd79f"]]);export{he as default};
